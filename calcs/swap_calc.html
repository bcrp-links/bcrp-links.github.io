<!doctype html>
<html>
<head>
<title>BCRP Swap Calculator</title>
<meta charset="utf-8" />
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/styles.css">
  <style>
#query-form {
    margin-bottom: 20px;
}

#data-table {
    width: 100%;
    border-collapse: collapse;
}

#data-table th, #data-table td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
}
</style>
</head>
<body>
<div id="header">
  <h1>
    BCRP Swap Calculator
  </h1>
  <h4>
    Enter your name and desired date for a swap, and this tool will identify residents in the BCRP eligible for a swap. It displays eligible residents by name and the shifts in which they are scheduled the day before, day of, and day after your request date. The tool is not perfect and any swaps MUST go through the Chiefs for approval, but hopefully this makes the process just a little easier :)
  </h4>
  <h4>
    For any issues, please email alex.butler@childrens.harvard.edu for bug fixes!
  </h4>
</div>
<div id="query-form">
  <label for="nameSelect">Name:</label>
  <select id="nameSelect" name="name">
    <!-- Options for names will be populated here -->
  </select>

  <label for="dateField">Date:</label>
  <input type="date" id="dateField">

  <button onclick="submitQuery()">Submit</button>
</div>

<table id="data-table">
  <thead>
    <!-- Dynamic headers will be set here -->
  </thead>
  <tbody>
    <!-- Data rows will be added here -->
  </tbody>
</table>


   <script>
    	const names = ['Abraham, Karan - PGY3',
  'Adeagbo, Oluwasegun - PGY1',
  'Agneta, Elizabeth - PGY2',
  'Ajayi, Omotola - PGY3',
  'Al Hassan, Sacha - PGY3',
  'Altchek, Alexa - PGY1',
  'Anand, Neha - PGY2',
  'Andersen, Kylie - PGY3',
  'Anwar, Shima - PGY3',
  'Aribindi, Haritha - PGY3',
  'Atwater, Sierra - PGY1',
  'Babinchak, W. Michael- PGY2',
  'Bachand, Jennifer - PGY3',
  'Bagchi, Devika - PGY2',
  'Ballantyne, Katie - PGY2',
  'Barson, Daniel - PGY1',
  'Bawa, Mausma - PGY3',
  'Beaudin, Marc - PGY2',
  'Belser, Abigail - PGY2',
  'Bender, Hannah - PGY1',
  'Bhansali, Paige - PGY3',
  'Bick, Katherine - PGY2',
  'Boddu , Praveen - PGY2',
  'Bowen, Caitlin - PGY2',
  'Brewster, Ryan - PGY3',
  'Brnich, Sarah - PGY2',
  'Brooks, Alexandra - PGY1',
  'Burdick, Kendall - PGY1',
  'Butler, Alex - PGY3',
  'Cahan, Eli - PGY2',
  'Cano Guerra, Christhian',
  'Carlston, Colleen - PGY3',
  'Carpenter, Kendall - PGY2',
  'Cassell, Anna - PGY3',
  'Chen, Pamela',
  'Chou, Francisca - PGY2',
  'Conrads, Tomas - PGY2',
  'Coomer, Charles - PGY1',
  'Cooper, Baillee - PGY1',
  'Corey, Jenelle - PGY1',
  'Curran, Tess - PGY3',
  "D'Souza, Alaric - PGY2",
  'Daulton, Robert - PGY3',
  'Davis, Haley - PGY2',
  'Day, Thomas - PGY3',
  'Delatour, Laurie - PGY3',
  'Delgado BÃ¡ez, Cristian - PGY2',
  'Delgado, Amanda - PGY1',
  'Diaz-Gil, Daniel - PGY2',
  'Dolstad, Hilary - PGY4',
  'Dosunmu-Ogunbi, Atinuke -PGY1',
  'Drastal, Meghan - PGY1',
  'Duckworth, Courtney - PGY2',
  'Duke, Corey - PGY2',
  'Dunne, Emma - PGY1',
  'Ealick, William - PGY3',
  'Eaton, Alexander - PGY1',
  'Edwards, Jeffrey - PGY3',
  'Fernandez-Ledon, Shannon - PGY1',
  'Fialkowski, Allison - PGY2',
  'Fields, British - PGY1',
  'Fowler, Benjamin - PGY1',
  'Frank, Camille - PGY2',
  'Frankiw, Luke - PGY2',
  'Gamble, Anna - PGY2',
  'Garcia Saiz, Edgar - PGY2',
  'Garrett, Kara - PGY2',
  'Gonzalez, Priscilla - PGY3',
  'Gootenberg, David - PGY3',
  'Grebber, Benjamin',
  'Gregory, Jessica - PGY2',
  'Gribbons, Katherine - PGY1',
  'Griffin, Kara - PGY2',
  'Hadley, Stephanie',
  'Hana, Marlin - PGY3',
  'Harowitz, Jenna - PGY1',
  'Hartswick, Emma - PGY1',
  'Henderson, Michaela - PGY1',
  'Heunis, Julia - PGY4',
  'Hilker, Sidney - PGY3',
  'Ikpeze, Adaobi - PGY3',
  'Inshaar, Hafza - PGY1',
  'Ip, Pui Yin Florence - PGY4',
  'Irwin, Margaret - PGY3',
  'Isbell, Tasia - PGY3',
  'Ishizuka, Andrew - PGY1',
  'Jamieson, Tara - PGY2',
  'Jiang, Connie - PGY1',
  'Jones, Maggie - PGY2',
  'Kalluri, Aditya - PGY3',
  'Khazanchi, Rohan - PGY2',
  'Kimmel, Alexandra - PGY2',
  'Kovatsis, Eleni - PGY1',
  'Kratochvil, Taylor - PGY2',
  'Kumar, Sachin - PGY1',
  'Kunhiabdullah, Shafeeque - PGY2',
  'Kwaning, Karen - PGY1',
  'Lachtrupp, Cara - PGY3',
  'Ladha, Feria - PGY1',
  'Laird, Jessica - PGY3',
  'Langat, Pinky - PGY2',
  'Laracuente, Ronald - PGY3',
  'Lawrence, Juliana - PGY3',
  'Lederer, Sophie - PGY2',
  'Lee, Jennifer J - PGY1',
  'Lee, Lauren - PGY1',
  'Liberati, Cristina',
  'Lin, Katerina - PGY3',
  'Liu, Alison - PGY1',
  'Liu, Patrick - PGY3',
  'Loizzo, Daniel - PGY1',
  'Lu, Nguyen - PGY2',
  'Lu-Culligan, Alice - PGY2',
  'Lucier, Amanda - PGY4',
  'Magner, Mira - PGY2',
  'Makkapati, Divya - PGY1',
  'Malik, Ahmed - PGY1',
  'Mancho, Amundam - PGY2',
  'Martin, Kathryn',
  'Mathias, Sitarah - PGY2',
  'McGill, Jocelyn - PGY2',
  'Meltzer-Bruhn, Ariana - PGY1',
  'Mertens, Nils - PGY1',
  'Meyers, Sarah - PGY3',
  'Michaelis, Katherine - PGY3',
  'Minhas, Prabhjot - PGY1',
  'Moore, Austin - PGY2',
  'Moore, Chandler - PGY1',
  'Moss, Mary - PGY3',
  'Nagy, Matthew - PGY1',
  'Need Staffing',
  'Neel, Dana',
  'Olsen, Hannah - PGY2',
  'Ortiz Rios, Marcos - PGY4',
  'Ozdogan, Elif - PGY2',
  'Palterer, Boaz - PGY1',
  'Parsons, Andrew - PGY3',
  'Passarelli, Maria - PGY1',
  'Pelpola, Judith - PGY3',
  'Pesec, Madeline - PGY4',
  'Pomerantz, Alex - PGY2',
  'Pontes Aires, Barbara',
  'Popov, Jelena - PGY2',
  'Porter, Grace - PGY1',
  'Pugh, Alicia',
  'Qiu, Mengting - PGY1',
  'Rafael, John-Alexander - PGY1',
  'Ramadas, Ramya - PGY3',
  'Ray, Randall - PGY2',
  'Rice, Marissa - PGY2',
  'Roberts, Holly - PGY1',
  'Rosanwo, Tolulope',
  'Russom, Faven - PGY1',
  'Sallam, Mohammad - PGY3',
  'Samandi, Layla - PGY3',
  'Sanchez Fernandez, Ivan - PGY2',
  'Schemm, Jeffrey - PGY1',
  'Schepel, Ianthe - PGY2',
  'Schiantarelli, Julia - PGY1',
  'Selcer, Raquel - PGY2',
  'Semmes, Eleanor - PGY1',
  'Sileo, Nicole - PGY1',
  'Smith, Abigail - PGY1',
  'Soffer, Elizabeth - PGY2',
  'Soled, Derek - PGY2',
  'Solmssen, Charlotte - PGY2',
  'Sorcher, Jill - PGY3',
  'Stevens, Christina - PGY3',
  'Stolte, Bjorn',
  'Surya, Sanjna - PGY2',
  'Taglienti, Michael - PGY1',
  'Tanson, Katherina - PGY1',
  'Tascon Arcilla, Jose - PGY2',
  'Temple, Caroline - PGY1',
  'Tersio, Isabelle - PGY1',
  'Thiele, Katri',
  'Vij, Abhya - PGY2',
  'Viola, Adrienne - PGY2',
  'Vivtcharenko, Victoria - PGY1',
  'Walther, Brandon - PGY1',
  'Wang, Annie',
  'Wang, Rita - PGY2',
  'Wickham, Kyle - PGY1',
  'Wijers, Christiaan - PGY1',
  'Williams, Alexis - PGY3',
  'Wychera, Chiara - PGY1',
  'Yeoh, Laura - PGY2',
  'Yue, Shanna - PGY2',
  'Zerihun, Lillian - PGY3',
  'Zhang, Anna',
  'Ziegler, Carly - PGY1'
]

window.onload = function() {
  let nameSelect = document.getElementById("nameSelect");
  names.forEach(function(name) {
    let option = document.createElement("option");
    option.value = name;
    option.text = name;
    nameSelect.appendChild(option);
  });
  var today = new Date().toISOString().split('T')[0];
  document.getElementById("dateField").setAttribute('min', today);
  var maxDate = "2024-06-30"; // Custom max date
  document.getElementById("dateField").setAttribute('max', maxDate);
};

// Function to calculate and update table headers based on selected date
function updateTableHeaders(selectedDate) {
  let date = new Date(selectedDate.concat('', 'T00:00:00'));
  let prevDate = formatDate(new Date(date.setDate(date.getDate() - 1)));
  let nextDate = formatDate(new Date(date.setDate(date.getDate() + 2)));
  let tableHeaders = ["Personnel", prevDate, selectedDate, nextDate];

  let thead = document.getElementById('data-table').getElementsByTagName('thead')[0];
  thead.innerHTML = ""; // Clear current headers
  let tr = document.createElement('tr');
  tableHeaders.forEach(header => {
    let th = document.createElement('th');
    th.innerText = header;
    tr.appendChild(th);
  });
  thead.appendChild(tr);
}

// Helper function to format dates to "YYYY-MM-DD"
function formatDate(date) {
  var d = new Date(date),
    month = '' + (d.getMonth() + 1),
    day = '' + d.getDate(),
    year = d.getFullYear();

  if (month.length < 2)
    month = '0' + month;
  if (day.length < 2)
    day = '0' + day;

  return [year, month, day].join('-');
}

// Function to handle form submission and data fetching
function submitQuery() {
  let selectedName = document.getElementById("nameSelect").value;
  let selectedDate = document.getElementById("dateField").value;

  updateTableHeaders(selectedDate);

  // Fetch data from Flask backend
  fetch('https://Butler925.pythonanywhere.com/process-data', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        name: selectedName,
        date: selectedDate
      })
    })
    .then(response => {
      if (!response.ok) {
        // If the server response is not ok, throw an error with the response status
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      // Check if there is an error message in the response data
      if (data.error) {
        // Display the error message to the user
        alert(data.error);
        return;
      }

      const tableBody = document.getElementById('data-table').getElementsByTagName('tbody')[0];
      tableBody.innerHTML = ""; // Clear current data
      data.forEach(row => {
        let tr = document.createElement('tr');
        let date = new Date(selectedDate.concat('', 'T00:00:00'));
        let prevDate = formatDate(new Date(date.setDate(date.getDate() - 1)));
        let nextDate = formatDate(new Date(date.setDate(date.getDate() + 2)));
        tr.innerHTML = `<td>${row.Personnel}</td>
                    <td>${row[prevDate]}</td>
                    <td>${row[selectedDate]}</td>
                    <td>${row[nextDate]}</td>`;
        tableBody.appendChild(tr);
      });
    })
    .catch(error => {
      // Handle network errors and other exceptions
      console.error('Error:', error);
      alert('An error occurred while fetching data. Please try again.');
    });
}
    </script>
</body>
</html>
